(()=>{"use strict";var e={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},t=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""};function n(e){e.classList.add("popup_is-opened"),e.addEventListener("click",o),document.addEventListener("keydown",r)}function o(e){e.target.classList.contains("popup")&&c(e.currentTarget)}function r(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&c(t)}}function c(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",r)}var a={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"fc5f532c-0391-4c7c-87f1-e53315000f78","Content-Type":"application/json"}},u=function(){return fetch("".concat(a.baseUrl,"/users/me"),{headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))};function i(e){var t=document.querySelector("#card-template").content.cloneNode(!0).firstElementChild,o=t.querySelector(".card__image"),r=t.querySelector(".card__title");t.cardId=e._id;var c=document.querySelector(".popup_type_image"),a=c.querySelector(".popup__image"),u=c.querySelector(".popup__caption");return o.src=e.link,o.alt=e.name,r.textContent=e.name,o.addEventListener("click",(function(){a.src=e.link,a.alt=e.name,u.textContent=e.name,n(c)})),t}var s,l,p=document.querySelector(".content"),d=p.querySelector(".places__list"),_=document.querySelector(".popup_type_edit"),f=document.querySelector(".popup_type_new-card"),m=document.querySelector(".popup_type_image"),v=document.querySelector(".popup_type_avatar-change"),h=document.forms["edit-profile"],y=document.forms["new-place"],S=document.forms["new-avatar"],b=S.elements.link,k=h.elements.name,L=h.elements.description,q=y.elements["place-name"],E=y.elements.link,g=document.querySelector(".profile__image"),C=S.elements.link,j=h.querySelector(".popup__button"),x=y.querySelector(".popup__button"),P=S.querySelector(".popup__button"),A=p.querySelector(".profile__edit-button"),U=_.querySelector(".popup__close"),T=p.querySelector(".profile__add-button"),w=f.querySelector(".popup__close"),D=m.querySelector(".popup__close"),I=v.querySelector(".popup__close"),N=p.querySelector(".profile__title"),O=p.querySelector(".profile__description"),J=_.querySelector(".popup__form"),B=f.querySelector(".popup__form"),H=J.querySelector(".popup__input_type_name"),z=J.querySelector(".popup__input_type_description"),M=B.querySelector(".popup__input_type_card-name"),F=B.querySelector(".popup__input_type_url");function G(e,t){e.textContent=t?"Сохранение...":"Сохранить"}function K(e){N.textContent=e.name,O.textContent=e.about,g&&e.avatar&&(g.style.backgroundImage="url('".concat(e.avatar,"')"))}function Q(e,t){!0===t?(e.removeAttribute("disabled"),e.classList.remove("popup__button_disabled")):(e.setAttribute("disabled",!0),e.classList.add("popup__button_disabled"))}l=e,Array.from(document.querySelectorAll(l.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,n){Array.from(e.querySelectorAll(n.inputSelector)).forEach((function(o){o.addEventListener("input",(function(){this.classList.add("touched"),function(e,n,o){n.validity.valid?t(e,n,o):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,n,n.validationMessage,o)}(e,o,n)}))}))}(e,l)})),_.classList.add("popup_is-animated"),f.classList.add("popup_is-animated"),m.classList.add("popup_is-animated"),v.classList.add("popup_is-animated"),P.addEventListener("click",(function(e){e.preventDefault();var t=b.value,n=e.target.closest(".popup__button");G(n,!0),function(e){return fetch("".concat(a.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():e.json().then((function(e){return Promise.reject(e)}))}))}(t).then((function(){return u()})).then((function(e){g.style.backgroundImage="url(".concat(e.avatar,")"),c(v)})).catch((function(e){console.error("Ошибка при обновлении аватара:",e)})).finally((function(){return G(n,!1)}))})),g.addEventListener("click",(function(){n(v),Q(P,!1)})),d.addEventListener("click",(function(e){if(e.target.classList.contains("card__like-button")){var t=e.target,n=t.closest(".places__item.card"),o=n.cardId,r=n.querySelector(".card__like-counter"),c=parseInt(r.textContent,10)||0,u=t.classList.contains("card__like-button_is-active");t.classList.toggle("card__like-button_is-active"),u?function(e){return fetch("".concat(a.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:a.headers}).then((function(e){return e.ok?e.json():e.json().then((function(e){return Promise.reject(e)}))}))}(o).then((function(){c--,r.textContent=c})).catch((function(e){console.error(e),t.classList.toggle("card__like-button_is-active"),c++,r.textContent=c})):function(e){return fetch("".concat(a.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(o).then((function(){c++,r.textContent=c})).catch((function(e){console.error(e),t.classList.toggle("card__like-button_is-active"),c--,r.textContent=c}))}})),J.addEventListener("submit",(function(e){e.preventDefault();var t,n,o=H.value,r=z.value,u=e.target.querySelector(".popup__button");G(u,!0),(t=o,n=r,fetch("".concat(a.baseUrl,"/users/me"),{method:"PATCH",headers:a.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){K(e),c(_)})).catch((function(e){console.error("Ошибка обновления профиля:",e)})).finally((function(){G(u,!1)}))})),B.addEventListener("submit",(function(e){e.preventDefault();var t=F.value,n=M.value,o=e.target.querySelector(".popup__button");G(o,!0);var r,u,s={name:n,link:t};(r=s.name,u=s.link,fetch("".concat(a.baseUrl,"/cards"),{method:"POST",headers:a.headers,body:JSON.stringify({name:r,link:u})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(t){var n=i({name:t.name,link:t.link});d.prepend(n),e.target.reset(),c(f)})).catch((function(e){console.error("Ошибка при добавлении карточки:",e)})).finally((function(){return G(o,!1)}))})),u().then((function(e){K(e),s=e._id})).catch((function(e){console.error("Ошибка загрузки данных:",e)})),A.addEventListener("click",(function(){H.value=N.textContent,z.value=O.textContent,Array.from(h.querySelectorAll(".popup__input")).forEach((function(n){t(h,n,e)})),Q(j,!0),n(_)})),U.addEventListener("click",(function(){c(_)})),T.addEventListener("click",(function(){y.reset(),Q(x,!1),y.querySelectorAll(".popup__input").forEach((function(e){e.classList.remove("touched")})),n(f)})),w.addEventListener("click",(function(){c(f)})),D.addEventListener("click",(function(){c(m)})),I.addEventListener("click",(function(){c(v)})),d.addEventListener("click",(function(e){if(e.target.classList.contains("card__delete-button")){var t=e.target.closest(".places__item.card");(n=t.cardId,fetch("".concat(a.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:a.headers}).then((function(e){return e.ok?e.json():e.json().then((function(e){return Promise.reject(e)}))}))).then((function(){t.remove()})).catch((function(e){console.error("Ошибка при удалении карточки:",e)}))}var n})),fetch("".concat(a.baseUrl,"/cards"),{headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){!function(e){e.forEach((function(e){var t=i(e),n=t.querySelector(".card__delete-button"),o=t.querySelector(".card__like-button");t.querySelector(".card__like-counter").textContent=e.likes.length,d.append(t),s!=e.owner._id&&(n.style.display="none"),e.likes.some((function(e){return e._id===s}))&&o.classList.add("card__like-button_is-active")}))}(e)})).catch((function(e){console.error("Ошибка при загрузке карточек:",e)})),h.addEventListener("input",(function(e){var t=k.value.length>1&&L.value.length>1;Q(j,t)})),y.addEventListener("input",(function(e){var t=E.value.length>1&&q.value.length>1;Q(x,t)})),S.addEventListener("input",(function(e){var t=C.value.length>1;Q(P,t)}))})();